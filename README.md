# `quads` - Geometry Tools

This package is a collection of quad geometry creation and manipulation tools. They can be used agnostic to any given library as they only operate on simple arrays and objects. The basic data structure is a simplicial complex of the form.

Please note that this package is an early release, and the APIs may stabilize over time. I also plan on adding more rigorous testing support.

```javascript
const quads = {
  positions: [[-1, 0, -1], [-1, 0, 1], [1, 0, 1], [1, 0, -1]],
  normals: [[0, 1, 0], [0, 1, 0], [0, 1, 0], [0, 1, 0]],
  cells: [[0, 1, 2, 3]]
}
```

This would define a single quad facing up on the Y axis of width 2, centered about the Y axis. The API mutates this simpicial complex with most operations that are performed. It generally attempts to keep the normals intact, but the occasional operation requires normals to be re-computed.

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### averageNormalForPosition

Computes the average normal for a position given the connected cells.

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `positionIndex` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `target` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)?** = \[]
-   `normalCache` **[Map](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map)?** = new Map() can be provided to cache intermediate normal computations.
-   `positionIndexToCells` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

Returns **any** the `targetNormal`

### clone

Clones a cell. Returns the new cell.

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `cell` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 

Returns **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** a new cell

### computeCellCenter

Computes the center of a single cell.

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `$1` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 
    -   `$1.aI` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
    -   `$1.bI` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
    -   `$1.cI` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
    -   `$1.dI` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

Returns **any** A new array

### computeCenterPositions

Computes all of the centers of all the cells.

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

Returns **any** A new array

### computeNormals

Updates all of the normals for all the positions using
[#averageNormalForPosition](#averageNormalForPosition). If a normal doesn't exist,
then it is created.

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** The quads

### createBox

Creates a quad box of the given dimensions. This box will render as a
smoothed out box, as the normals are averaged. This is typically used for a
starting place for subdividing or extrusion operations. If the
`optionalQuads` object is passed, then the box will be created inside of
that simplicial complex, otherwise a new quads simplicial complex will be
generated.

**Parameters**

-   `x` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `y` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `z` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `optionalQuads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** a simplicial complex

### createBoxDisjoint

Creates a quad box of the given dimensions, but with non-joined positions.
This box renders as a flat shaded box. If the optionalQuads object is
passed, then the box will be created inside of that simplicial complex,
otherwise a new quads simplicial complex will be generated.

**Parameters**

-   `x` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)?= 1** 
-   `y` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)?= 1** 
-   `z` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)?= 1** 
-   `optionalQuads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** a simplicial complex

### createQuad

Create a quad with options. If the optionalQuads object is passed, then the
quad will be created inside of that simplicial complex, otherwise a new
quads simplicial complex will be generated. Both the quads simplicial
complex and the created cell are returned in an object.

**Parameters**

-   `options` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)?= {}** 

**Examples**

_Usage:_

```javascript
const {quads, cell} = createQuad({ positions: [[-1, 0, -1], [-1, 0, 1], [1, 0, 1], [1, 0, -1]] })
const {quads, cell} = createQuad({ w: 1, h: 1 })
const {quads, cell} = createQuad()
```

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** `{quads, cell}`

### elementsFromQuads

Returns an elements array using the given `ArrayType`, which can be used by WebGL.

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `drawMode` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?= 'triangles'** 
-   `ArrayType` **typeof?= Uint16Array** 

Returns **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** Elements using the given `ArrayType`, which can be used by WebGL.

### extrude

Given a target cell, first inset it, then move it along the cell's normal
outwards by a given distance.

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `targetCell` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 
-   `insetT` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `extrude` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

### extrudeDisjoint

Given a target cell, first inset it, then move it along the cell's normal
outwards by a given distance, but all new geometry generated will not
share positions.

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `targetCell` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 
-   `insetT` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `extrude` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

### flip

Flip a cell's normal to point the other way. Returns the cell.

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `cell` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 

Returns **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** The cell

### getCellFromEdge

Find a cell given two position indices. Optionally provide a `previousCell`
that will not be matched against. Returns the first cell that matches.

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `positionIndexA` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `positionIndexB` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `previousCell` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)?** Optional will not be matched against

Returns **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** Elements using the given `ArrayType`, which can be used by WebGL.

### getCellNormal

Compute a cell's normal regardless of it's neighboring cells.

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `cell` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 
-   `target` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)?** **= \[]**

Returns **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** The target normal.

### getCellsFromPositionIndex

Given a position index, find any cells that include it.

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `index` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `target` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)?= \[]** 

Returns **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** The target cells.

### getCenter

Computes the center of a cell

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `cell` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 
-   `target` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)?= \[]** 

Returns **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** the targetPosition

### getLoop

Gets a loop of cells. Given a single cell, start walking in both
directions to select a loop. .

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `cell` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 
-   `type` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** can either be `"cells"`, `"positions"`, or `"normals"`.
-   `opposite` **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** will walk in the opposite direction, e.g. up and down, versus left and right

Returns **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** an array according to the `type`.

### getNewGeometry

Get all newly created geometry of the given type from whatever arbitrary
operations were done on the quads. This assumes new geometry was created
and not destroyed.

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `key` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `callback` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** 

**Examples**

_Usage:_

```javascript
const extrudedCells = quad.getNewGeometry(quads, "cells", () => {
  quad.extrude(quads, tipCell, 0.5, 3)
});
```

Returns **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 

### inset

Inset a cell some value between `0` (its edges) and `1` (its center).

     b----------c
     |\   q1   /|
     | \      / |
     |  f----g  |
     |q0| tQ |q2|
     |  e----h  |
     | /      \ |
     |/   q3   \|
     a----------d

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `targetCell` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 
-   `t` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** Specifies where the split should be. Ranged from `0` to `1`

Returns **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** cells `[q0, q1, q2, q3, tC]` where `tC` is the `targetCell`.

### insetDisjoint

Inset a cell some value between `0` (its edges) and `1` (its center), but
keep the new cells disjoint so they do not share any positions.

         bT----------cT
     bL   \    qT    /   cR
     |\    \        /    /|
     | \    fT----gT    / |
     |  fL  fM----gM  gR  |
     |qL|   |  tC |    |qR|   tC = targetCell
     |  eL  eM----hM  hR  |
     | /    eB----hB    \ |
     |/    /        \    \|
     aL   /    qB    \   dR
         aB----------dB

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `targetCell` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 
-   `t` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)?** **=0**

Returns **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** cells `[q0, q1, q2, q3, tC]` where `tC` is the `targetCell`.

### insetLoop

Given a cell, walk a loop and inset the loop, where 0 is the inset being on
the edge, and 1 the inset being in the enter. Setting opposite to true will
make the cell walk the loop in the opposite direction, e.g. up/down rather
than left/right.

    *----*----*----*----*----*----*----*----*
    |    |    |    |    |    |    |    |    |
    |----|----|----|----|----|--->|    |    |
    |    |    |    |    |    |    |    |    |
    |----|----|----|----|----|--->|    |    |
    |    |    |    |    |    |    |    |    |
    *----*----*----*----*----*----*----*----*

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `cell` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 
-   `t` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)?= 0.5** Specifies where the split should be. Ranged from `0` to `1`
-   `opposite` **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** will walk in the opposite direction, e.g. up and down, versus left and right

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** quads

### mergePositions

Combine all positions together and recompute the normals.

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** the quads

### mirror

Clone all existing geometry, and mirror it about the given axis.

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `cells` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 
-   `axis` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** is either `0`, `1`, or `2`, which represents the `x`, `y`, and `z` axis respectively.

### splitHorizontal

Split a cell horizontally.

     b--------c
     |        |
     ab------cd
     |        |
     a--------d

**Parameters**

-   `$0` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `$0.positions` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 
    -   `$0.cells` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 
-   `targetCell` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 
-   `t` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)?= 0.5** Specifies where the split should be. Ranged from `0` to `1`

### splitHorizontalDisjoint

Split a cell horizontally into two new disconnected cells.

     b--------c
     |        |
     ab1----cd1
     ab2----cd2
     | target |
     a--------d

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `targetCell` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 
-   `t` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)?= 0.5** Specifies where the split should be. Ranged from `0` to `1`

### splitLoop

Given a cell, walk along the quads in both directions and split the cell.

    *--------*--------*--------*--------*--------*--------*--------*
    |        |        |        |        |        |        |        |
    *        *<-------*--------*--cell--*--------*------->*        *
    |        |        |        |        |        |        |        |
    *--------*--------*--------*--------*--------*--------*--------*

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `cell` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 
-   `t` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)?= 0.5** Specifies where the split should be. Ranged from `0` to `1`
-   `opposite` **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** will walk in the opposite direction, e.g. up and down, versus left and right

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** quads

### splitVertical

Split a cell horizontally.

     b---bc---c
     |   |    |
     |   |    |
     a---ad---d

**Parameters**

-   `$0` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** quad
    -   `$0.positions` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 
    -   `$0.cells` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 
-   `targetCell` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 
-   `t` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)?= 0.5** Specifies where the split should be. Ranged from `0` to `1`

### splitVerticalDisjoint

Split a cell horizontally into two new disconnected cells.

     b---bc1  bc2---c
     |     |  |     |
     |     |  |     |
     a---ad1  ad2---d

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `targetCell` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 
-   `t` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)?= 0.5** Specifies where the split should be. Ranged from `0` to `1`

### subdivide

Use catmull clark subdivision to smooth out the geometry. All normals will
be recomputed. Under the hood this is a convenience function for the
module [gl-catmull-clark](https://www.npmjs.com/package/gl-catmull-clark).

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `subdivisions` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `positions` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)?= quads.positions** 
-   `cells` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)?= quads.cells** 

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** quads

### updateNormals

Updates all of the normals for all the positions using
[#averageNormalForPosition](#averageNormalForPosition). If a normal doesn't exist,
then it is created.

**Parameters**

-   `quads` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `cell` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** quads
